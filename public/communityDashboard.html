import React, { useEffect, useState } from 'react';
import { Card, CardContent } from '@/components/ui/card';
import { auth, db, collection, getDocs, query, orderBy, limit } from './firebaseConfig';

<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

const CommunityDashboard = () => {
    const [topConsecutive, setTopConsecutive] = useState([]);
    const [topActiveDays, setTopActiveDays] = useState([]);
    const [longestStreak, setLongestStreak] = useState(null);
    const [totalUsers, setTotalUsers] = useState(0);

    useEffect(() => {
        async function fetchLeaderboardData() {
            try {
                const usersRef = collection(db, 'users');

                // Top 5 Highest Consecutive Days
                const consecutiveQuery = query(usersRef, orderBy('consecutiveDays', 'desc'), limit(5));
                const consecutiveSnapshot = await getDocs(consecutiveQuery);
                setTopConsecutive(consecutiveSnapshot.docs.map(doc => doc.data()));

                // Top 5 Most Active Days
                const activeQuery = query(usersRef, orderBy('totalActiveDays', 'desc'), limit(5));
                const activeSnapshot = await getDocs(activeQuery);
                setTopActiveDays(activeSnapshot.docs.map(doc => doc.data()));

                // Current Longest Active Streak
                const streakQuery = query(usersRef, orderBy('consecutiveDays', 'desc'), limit(1));
                const streakSnapshot = await getDocs(streakQuery);
                setLongestStreak(streakSnapshot.docs[0]?.data() || null);

                // Total Users
                const totalSnapshot = await getDocs(usersRef);
                setTotalUsers(totalSnapshot.size);

            } catch (error) {
                console.error('Error fetching leaderboard data:', error);
            }
        }

        fetchLeaderboardData();
    }, []);

    return (
        <div className="p-6 space-y-4 text-white">
            <h1 className="text-3xl font-bold text-center mb-4">Community Dashboard</h1>
            <Card className="p-4 bg-[#635985]">
                <CardContent>
                    <h2 className="text-xl font-semibold">Total Users: {totalUsers}</h2>
                    {longestStreak && (
                        <p className="mt-2">Current Longest Active Streak: {longestStreak.username} - {longestStreak.consecutiveDays} days</p>
                    )}
                </CardContent>
            </Card>

            <div className="grid gap-4 md:grid-cols-2">
                <Card className="p-4 bg-[#635985]">
                    <CardContent>
                        <h3 className="text-lg font-semibold">Top 5 Consecutive Days</h3>
                        <ul>
                            {topConsecutive.map((user, index) => (
                                <li key={index}>{user.username}: {user.consecutiveDays} days</li>
                            ))}
                        </ul>
                    </CardContent>
                </Card>
                <Card className="p-4 bg-[#635985]">
                    <CardContent>
                        <h3 className="text-lg font-semibold">Top 5 Active Days</h3>
                        <ul>
                            {topActiveDays.map((user, index) => (
                                <li key={index}>{user.username}: {user.totalActiveDays} days</li>
                            ))}
                        </ul>
                    </CardContent>
                </Card>
            </div>
        </div>
    );
};

export default CommunityDashboard;
