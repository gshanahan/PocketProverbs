<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Dashboard</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <!-- Include your global CSS file -->
    <link rel="stylesheet" href="./css/global.css">
</head>
<body class="community-dashboard-body">

    <div class="community-dashboard-container">
        <h1 class="community-dashboard-title">Community Dashboard</h1>

        <div id="total-users" class="community-card">
            <h2>Total Users: <span id="user-count">0</span></h2>
            <p id="longest-streak"></p>
        </div>

        <div class="community-grid">
            <div class="community-card">
                <h3>Top 5 Consecutive Days</h3>
                <ul id="top-consecutive"></ul>
            </div>
            <div class="community-card">
                <h3>Top 5 Active Days</h3>
                <ul id="top-active-days"></ul>
            </div>
        </div>
    </div>

    <script>
        // Initialize Firebase
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore(app);

        // Fetch leaderboard data from Firestore
        async function fetchLeaderboardData() {
            try {
                const usersRef = db.collection("users");

                // Top 5 Highest Consecutive Days
                const consecutiveQuery = usersRef.orderBy('consecutiveDays', 'desc').limit(5);
                const consecutiveSnapshot = await consecutiveQuery.get();
                const topConsecutive = consecutiveSnapshot.docs.map(doc => doc.data());

                // Top 5 Most Active Days
                const activeQuery = usersRef.orderBy('totalActiveDays', 'desc').limit(5);
                const activeSnapshot = await activeQuery.get();
                const topActiveDays = activeSnapshot.docs.map(doc => doc.data());

                // Current Longest Active Streak
                const streakQuery = usersRef.orderBy('consecutiveDays', 'desc').limit(1);
                const streakSnapshot = await streakQuery.get();
                const longestStreak = streakSnapshot.docs[0]?.data() || null;

                // Total Users
                const totalSnapshot = await usersRef.get();
                const totalUsers = totalSnapshot.size;

                // Update the UI
                document.getElementById('user-count').textContent = totalUsers;
                if (longestStreak) {
                    document.getElementById('longest-streak').textContent = `Current Longest Active Streak: ${longestStreak.username} - ${longestStreak.consecutiveDays} days`;
                }

                // Update Top 5 Consecutive Days
                const consecutiveList = document.getElementById('top-consecutive');
                topConsecutive.forEach(user => {
                    const li = document.createElement('li');
                    li.textContent = `${user.username}: ${user.consecutiveDays} days`;
                    consecutiveList.appendChild(li);
                });

                // Update Top 5 Active Days
                const activeList = document.getElementById('top-active-days');
                topActiveDays.forEach(user => {
                    const li = document.createElement('li');
                    li.textContent = `${user.username}: ${user.totalActiveDays} days`;
                    activeList.appendChild(li);
                });

            } catch (error) {
                console.error('Error fetching leaderboard data:', error);
            }
        }

        // Run the function on page load
        window.onload = fetchLeaderboardData;
    </script>

</body>
</html>
